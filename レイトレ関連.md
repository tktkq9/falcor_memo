# レイトレ関連
Falcorプロジェクトのレイトレに関する部分のまとめ  

## FalcorプロジェクトのRtProgram関連
[ProgramVars, ParameterBlock, ProgramReflection関連](https://github.com/tktkq9/falcor_memo/blob/master/ProgramVars%2C%20ParameterBlock%2C%20ProgramReflection%E9%96%A2%E9%80%A3.md)、  
[ProgramVersion, Program, Shaderファイル関連]()  
のうち、DXR用の処理が必要な部分の実装  

### RtProgram
Programのサブクラス、DXR用Programクラス  
ラスタライズとは違うエントリーポイントを使うので、そこら辺の情報を格納するためのDescはDXR用に新しく作り直されている  




## CPUSampleGenerator関連
CPU側で扱うサンプラー  
今のところはカメラのジッター生成にのみ使われている  

TODO : PBRTとか見て界隈ではどれがよく使われているか確認。なかったら実装も視野。確かハルトンが結構使われていた気がする  

### CPUSampleGenerator
様々なサンプルジェネレーターのインターフェースクラス  
アブストラクトクラスとなっているので使うときはこれのサブクラスを利用する  

### DxSamplePattern
CPUSampleGeneratorのサブクラス  
DirectX MSAA sample pattern generator  
nextするたびにMSAAの次のサンプル箇所に対応する値が取得できる  
8サンプル固定  

### HaltonSamplePattern
CPUSampleGeneratorのサブクラス  
Halton sample pattern generator  
ハルトンサンプラーは以下参照  
[7.4 The Halton Sampler](http://www.pbr-book.org/3ed-2018/Sampling_and_Reconstruction/The_Halton_Sampler.html#)  
このPBRTv3の2Dサンプラーと同じように、(基数2サンプル, 基数3サンプル)を返す  

### StratifiedSamplePattern
CPUSampleGeneratorのサブクラス  
stratified random sample pattern generator  
Stratifiedサンプラーは以下参照  
[7.3 Stratified Sampling](http://www.pbr-book.org/3ed-2018/Sampling_and_Reconstruction/Stratified_Sampling.html#)  
この参照にある_Latin hypercube sampling_が実装されている（たぶんね）  

## SampleGenerator
レイトレとかGPU側で使うサンプル生成slang管理クラス  

シェーダー側のSampleGeneratorはSampleGeneratorType.slanghにある#defineでどのサンプラーを使うか決めればいいだけなので、  
このクラスではそのDefineListを管理しているだけ  

ハルトンとかは現状ない。Ray Tracing Gemsとかに実装されてるので持ってきてもいいかも  

### SampleGenerator.slang
1D、2D、3DサンプルをSampleGeneratorから作成する  
SampleGeneratorはISampleGeneratorインターフェースによってによって実装されている

ISampleGeneratorは
UniformSampleGenerator.slangとTinyUniformSampleGenerator.slangの2つであり、
SampleGeneratorType.slanghで定義されている#defineでどちらを使うが制御される  

### UniformSampleGenerator.slang
一様ランダム   
SplitMix64でpixelとsampleNumberからseedを作り、 
Xoshiroでランダム生成をしている  

### TinyUniformSampleGenerator.slang
軽い一様ランダム  
pixelとsampleNumberからseedを作り、 
LCGでランダム生成している  

<!--stackedit_data:
eyJoaXN0b3J5IjpbNjIxMTUzNjQ1LC0xNDIyMTM1MjI2LC0xOT
kwNjU4MTYxLDE1MTU3MjkwMjEsLTE2NDYwODQyMjIsODgyNTA0
MzMyLDE0ODA1ODE0MjgsMTQ2OTExOTUyNiwxNDQxODM5MDUwLC
0xMzM4MDQ1MjkyLC0xMzc2ODkyOTY3LDE4MjEwNDU2MDQsNjQ2
NjQzNzY2LC02ODQ2NjM2OTYsMTU4MTI1NjI3MSwtMTA3MzIxNT
kyMSwxNTk1MTgzNTI2LDI2OTA3NzY2OV19
-->